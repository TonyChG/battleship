/*
Battleship project

* https://github.com/polymorphl
* https://github.com/TonyChG

Version: 0.1.0
Full source at https://github.com/TonyChG/battleship
*/
function Box(i){this.box=i,this.isPlay=!1,this.ship=0,this.className="default"}function randomNumber(i,e){return Math.floor(Math.random()*e+i)}function initAttributGrid(){$(".grid1, .grid2").each(function(i){$(".grid"+String(i+1)+" .box").each(function(e){$(this).attr("data-x",e%gridSize),$(this).attr("data-y",parseInt(e/gridSize)),$(this).attr("grid-n",i+1)})})}function newGrid(i){var e=[];return $(".grid"+String(i)+" .box").each(function(i){e[i]=new Box($(this))}),e}function putOneShip(i,e,r,t,o){for(var a=shipConst[o].size,n=0,s=0,l=0;a>l;l++)n=l*coefTab[t].x,s=l*coefTab[t].y,i[e+n+(r+s)*gridSize].addShip(shipConst[o].size,shipConst[o].name)}function getPossibleDir(i,e,r,t){var o=[!0,!0,!0,!0],a=shipConst[t].size;return coefTab.forEach(function(r,t){for(var n=0;a>n;n++)(i+n*r.x<0||e+n*r.y<0||i+n*r.x>9||e+n*r.y>9)&&(o[t]=!1)}),o.forEach(function(t,n){if(t)for(var s=0;a>s;s++)0!==r[i+s*coefTab[n].x+(e+s*coefTab[n].y)*gridSize].ship&&(o[n]=!1)}),o}function clearGrid(i){var e=i[0].box.attr("grid-n");$(".grid"+e+" .box").each(function(e){i[e].ship||i[e].color("default")})}function getDir(i,e,r,t,o,a){var n=shipConst[a].size,s=-1,l=!0;if(e===t&&r+(n-1)===i&&(s=3),e===t&&i+(n-1)===r&&(s=1),i===r&&e+(n-1)===t&&(s=2),i===r&&t+(n-1)===e&&(s=0),-1!=s)for(var d=0;n>d;d++)o[coefTab[s].x*d+i+(coefTab[s].y*d+e)*gridSize].ship&&(l=!1);return s=l?s:-1}function onClickPositionPhase(i,e,r,t,o,a){var n=0,s=0,l=getPossibleDir(r,t,i,e),d=!1,c=-1,h="";return o.length>1&&a.length>1&&(n=o[o.length-2],s=a[a.length-2],i[n+s*gridSize].ship||i[r+t*gridSize].ship||(c=getDir(n,s,r,t,i,e),-1!=c&&(putOneShip(i,n,s,c,e),e++,d=!0))),clearGrid(i),d||l.forEach(function(o,a){if(o)for(var n=0;n<shipConst[e].size;n++)h=n===shipConst[e].size-1?"possible":"clicked",i[r+n*coefTab[a].x+(t+n*coefTab[a].y)*gridSize].color(h)}),e}function computerPlay(i){for(var e=randomNumber(0,gridSize),r=randomNumber(0,gridSize);i[e+r*gridSize].isPlay;)e=randomNumber(0,gridSize),r=randomNumber(0,gridSize);i[e+r*gridSize].ship?i[e+r*gridSize].play("played_ship"):i[e+r*gridSize].play("played_nothing")}function onClickGamePhase(i,e,r,t){e[r+t*gridSize].isPlay||(e[r+t*gridSize].ship?e[r+t*gridSize].play("played_ship"):e[r+t*gridSize].play("played_nothing"),computerPlay(i))}function clickOnPlayerGrid(i,e){var r=0,t=[],o=[];$(".grid2 .box").click(function(){var a=parseInt($(this).attr("data-x")),n=parseInt($(this).attr("data-y"));t.push(a),o.push(n),r<shipConst.length?r=onClickPositionPhase(i,r,a,n,t,o):$(".grid1 .box").click(function(){var r=parseInt($(this).attr("data-x")),t=parseInt($(this).attr("data-y"));onClickGamePhase(i,e,r,t)})})}function displayGrid(i){i.forEach(function(i,e){i.play?i.color("default"):i.ship?i.color("played_ship"):i.color("played_nothing")})}function possibleToPutShip(i,e,r,t){for(var o=!1,a=getPossibleDir(i,e,r,t),n=0;n<a.length;n++)a[n]||(o=!0);return o}function getSelectDir(i){for(var e=randomNumber(0,i.length-1);!i[e];)e=randomNumber(0,i.length-1);return e}function putRandShips(i){var e=0,r=randomNumber(0,gridSize),t=randomNumber(0,gridSize),o=[];shipConst.forEach(function(a,n){for(;i[r+t*gridSize].ship&&possibleToPutShip(r,t,i,n)&&1e3>e;)r=randomNumber(0,gridSize),t=randomNumber(0,gridSize),e++;o=getPossibleDir(r,t,i,n),putOneShip(i,r,t,getSelectDir(o),n)})}function mainGame(){var i=newGrid(2),e=newGrid(1);initAttributGrid(),putRandShips(e),clickOnPlayerGrid(i,e),displayGrid(e)}!function(i){i.fn.isolatedScroll=function(e){"use script";return defaults={autoscroll:!0},e=i.extend(defaults,e),this.bind("touchmove mousewheel DOMMouseScroll",function(r){if(!e.autoscroll||i(this).outerHeight()<i(this)[0].scrollHeight){var t=r.originalEvent,o=t.wheelDelta||-t.detail;this.scrollTop+=30*(0>o?1:-1),r.preventDefault()}})}}(jQuery),$(window).load(function(){console.log("loaded -- sourcemap OK ?");$(".flexslider").isolatedScroll(),$(".flexslider").flexslider({animation:"slide",selector:".boats > .boat",animationLoop:!1,mousewheel:!1,slideshow:!1,slideshowSpeed:2e3,reverse:!0,itemWidth:210,minItems:1,maxItems:1,move:0,itemMargin:5,start:function(i){var e=null,r=!1;$(".flexslider").on("mousewheel",function(t,o,a,n){if(e&&clearTimeout(e),!r){var s=0>o?i.getTarget("next"):i.getTarget("prev");i.flexAnimate(s,!0)}r=!0,e=setTimeout(function(){r=!1},300)})}});var i=0;$("#add").click(function(){div="<li class='boat'><span>"+i+". Number what?</span></li>",$(".flexslider").data("flexslider").addSlide($(div)),i++})});const gridSize=10,shipConst=[{name:"aircraft-carrier",size:5,color:"#6E6E6E",id:0},{name:"battlecruiser",size:4,color:"#B18904",id:1},{name:"destroyer",size:3,color:"#298A08",id:2},{name:"submarine",size:3,color:"#61210B",id:3},{name:"torpedo",size:2,color:"#8A0829",id:4}],coefTab=[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}];Box.prototype.color=function(i){this.box.removeClass(String(this.className)).addClass(String(i)),this.className=i},Box.prototype.play=function(i){this.isPlay=!0,this.box.removeClass(String(this.className)).addClass(String(i)),this.className=i},Box.prototype.addShip=function(i,e){this.ship=i,this.box.removeClass(String(this.className)).addClass(String(e)),this.className=e},$(function(){$(".grid1>div").clone().appendTo(".grid2"),mainGame()});
//# sourceMappingURL=bundle.js.map
